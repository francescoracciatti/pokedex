language: python
python: "3.9-dev"

sudo: required

services:
  - docker

env:
  jobs:
    - USE_NETWORK=true

before_install:
  - pip install -r requirements.txt
  - pip install -e .

jobs:
  include:
    - stage: build server
      script:
        - docker build --tag pokedex .

    - stage: run server
      script:
        - docker run -d --network host -p 6000:6000 pokedex

    - stage: test
      script:
        - cd test
        - python test_api.py --host 127.0.0.1 --port 6000 TestAPI